<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style/styleQuiz.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Document</title>
</head>

<body>
    <div class="content-navbar">
        <div class="navbar">

            <div class="img-logo" onclick="clicar()">
                <img src="./img/tachanca-bebe.png" alt="">
            </div>
            <div class="text-navbar">
                <div class="pginicial"><a href="./Index.html">HOME</a></div>
                <div class="mapas"><a href="./mapas.html">MAPAS</a></div>
                <div class="agente"><a href="./agentes.html">AGENTES</a></div>
                <div id="login" class="login">
                    <a onclick="sair()" href="./Index.html">SAIR</a>
                </div>
            </div>

        </div>

    </div>

    <div class="usuario">
         USUARIO
        <div id="dados_usuario" class="dados-usuario">
        </div>
    </div>
    <div class="calc-kda">
        <div class="inf-kda">Infromer suas kills:<input type="number" name="" id="inp_kill"></div>
        <div class="inf-kda">Informe suas mortes:<input type="number" name="" id="inp_mortes"></div>
        <div class="inf-kda">Informe suas assistencia:<input type="number" name="" id="inp_assistencia"></div>

        <div class="result" ><div>Resultado:</div>
        <div class="receber-kda" id="receber_kda"></div></div>
        <button class="calcular-kda" onclick="calcular_kda()">calcular</button>
    </div>
    <div class="titulo">QUIZ DO TACHANKA</div>
    <div class="conteiner-quiz">
        <div class="content-pergunta">
            <div class="titulo-questao">1-Qual agente não é atacante?</div>
            <div class="content-questao">
                <span class="questao">(A) Sldge</span>
                <span class="questao">(B) Capitão</span>
                <span class="questao">(C) Frost</span>
                <span class="questao">(D) Ying</span>
            </div>
            <div class="resposta"><span>informe a sua resposta:</span><input maxlength="1" id="resposta1"></div>
        </div>
        <div class="content-pergunta">
            <div class="titulo-questao">2-Quais os agentes que tem escudos?</div>
            <div class="content-questao">
                <span class="questao">(A) Fuze-Smoke-Osa-Sens</span>
                <span class="questao">(B) Grim-Meluse-Twitch</span>
                <span class="questao">(C) Clash-Blitz-Fuze-montagne</span>
                <span class="questao">(D) Vigil</span>
            </div>
            <div class="resposta"><span>informe a sua resposta:</span><input maxlength="1" id="resposta2"></div>
        </div>
        <div class="content-pergunta">
            <div class="titulo-questao">3-Quais agentes podem curar no game?</div>
            <div class="content-questao">
                <span class="questao">(A) Smoke-Blitz-Fuze</span>
                <span class="questao">(B) Frost-Doc-Maestro</span>
                <span class="questao">(C) Vigil-Clash</span>
                <span class="questao">(D) Doc-Thunderbird-Finka</span>
            </div>
            <div class="resposta"><span>informe a sua resposta:</span><input maxlength="1" id="resposta3"></div>
        </div>
        <div class="content-pergunta">
            <div class="titulo-questao">4-Quem é irmã da Ela?</div>
            <div class="content-questao">
                <span class="questao">(A) Zofia</span>
                <span class="questao">(B) Caveira</span>
                <span class="questao">(C) Brava</span>
                <span class="questao">(D) Ying</span>
            </div>
            <div class="resposta"><span>informe a sua resposta:</span><input maxlength="1" id="resposta4"></div>
        </div>
        <div class="content-pergunta">
            <div class="titulo-questao">5-Que agente utiliza uma marreta?</div>
            <div class="content-questao">
                <span class="questao">(A) Fuze</span>
                <span class="questao">(B) Grim</span>
                <span class="questao">(C) Sledge</span>
                <span class="questao">(D) Smoke</span>
            </div>
            <div class="resposta"><span>informe a sua resposta:</span><input maxlength="1" id="resposta5"></div>
        </div>
        <div class="content-pergunta">
            <div class="titulo-questao">6-Qual agente tem a habilidade de hacker?</div>
            <div class="content-questao">
                <span class="questao">(A) Finka</span>
                <span class="questao">(B) Ash</span>
                <span class="questao">(C) Clash</span>
                <span class="questao">(D) Dokkaebi</span>
            </div>
            <div class="resposta"><span>informe a sua resposta:</span><input maxlength="1" id="resposta6"></div>
        </div>
        <div class="content-pergunta">
            <div class="titulo-questao">7-Qual o maior ranking do Rainbow six??</div>
            <div class="content-questao">
                <span class="questao">(A) Master Legue</span>
                <span class="questao">(B) Master</span>
                <span class="questao">(C) Diamante</span>
                <span class="questao">(D) Campeão</span>
            </div>
            
            <div class="resposta"><span>informe a sua resposta:</span><input maxlength="1" id="resposta7"></div>
        </div>

        <div id="results" class="results"></div>
        <div id="btn_respostas" class='btn-respostas' onclick="respostas()">Enviar respostas</div>
        <div style="display: none;" id="resetar" class='btn-respostas' onclick="limpar()">resetar</div>
    </div>

    <div class="grafico">
        <canvas id='ranking_quiz' style="width:200px; height: 300px;"></canvas>
        
    </div>
    <div id="div_calculos" class="calculos"></div>
    
</body>

</html>

<script>
    var jones = []
    var partidas = 0
    var pontos = 0
    var qtdpontos = 0

    dados_usuario.innerHTML = `            <div class="txt-dados-usuario">Apelido:${sessionStorage.getItem('apelido')} </div>
            <div class="txt-dados-usuario">E-mail:${sessionStorage.getItem('EMAIL_USUARIO')}</div>`
    

    function respostas() {
        btn_respostas.style.display = "none"
        resetar.style.display = "flex"
        var id = sessionStorage.getItem('id')
        results.innerHTML = ""

        var r1 = (resposta1.value).toUpperCase()
        var r2 = (resposta2.value).toUpperCase()
        var r3 = (resposta3.value).toUpperCase()
        var r4 = (resposta4.value).toUpperCase()
        var r5 = (resposta5.value).toUpperCase()
        var r6 = (resposta6.value).toUpperCase()
        var r7 = (resposta7.value).toUpperCase()




        if (r1 == "C") {
            pontos += 1
        }
        else {
            results.innerHTML += `1-Você errou<br>`
        }
        if (r2 == "C") {
            pontos += 2
        }
        else {
            results.innerHTML += `2-Você errou<br>`
        }
        if (r3 == "D") {
            pontos += 1
        }
        else {
            results.innerHTML += `3-Você errou<br>`
        }
        if (r4 == "A") {
            pontos += 1
        }
        else {
            results.innerHTML += `4-Você errou<br>`
        }
        if (r5 == "C") {
            pontos += 1
        }
        else {
            results.innerHTML += `5-Você errou<br>`
        }
        if (r6 == "D") {
            pontos += 2
        }
        else {
            results.innerHTML += `6-Você errou<br>`
        }
        if (r7 == "D") {
            pontos += 2
        }
        else {
            results.innerHTML += `7-Você errou<br>`
        }
        console.log(pontos)
        fetch("/usuarios/pontos", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                idServer: id,
                pontosServer: pontos,


            })
        }).then(function (resposta) {
            console.log("resposta", resposta)
            if (resposta.ok) {
                console.log("logado com sucesso")
                
            }
            else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        })

        setTimeout(() => {
            plotar()
        }, 100);

    }
    function plotar() {
        var id = sessionStorage.getItem('id')
        fetch("/usuarios/pegarponto",
        {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                idServer: id,


            })


        }).then(function (resposta) {
            if (resposta.ok) {
                resposta.json().then(function (response) {

                    for (var i = 0; i < response.length; i++) {
                        var registro = response[i]
                        jones.push(registro.pontos_quiz)
                        qtdpontos += jones[i]
                        partidas += 1

                        localStorage.setItem(`usuario${id}`, JSON.parse(registro.pontos_quiz))

                    }
                    // console.log(registro, "aqui é registro")
                    // console.log(jones, "aqui é jones")



                    var ctx = document.getElementById('ranking_quiz')

                    var tachanka = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['QUANTIDADE DE PONTOS'],
                            datasets: [{
                                label: 'PONTOS DE TODAS AS SUAS PARTIDAS',
                                data: [qtdpontos],
                                borderWidth: 5,
                                borderColor: ' rgba(114, 224, 218, 0.651)',
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                        
                    });
                    div_calculos.innerHTML = `<div><span>Pontos desta rodada: ${pontos}</span>
            Quantidade De vezes jogadas: ${partidas}</div><div>Pontos totais: ${qtdpontos}</div>`
            pontos = 0

                })
            }
        })

        


    }


    function sair() {
        sessionStorage.clear('EMAIL_USUARIO')
    }
    function limpar() {
        window.location = "./quiz.html";

    }
</script>

<script>
    function calcular_kda()
    {
        var assistencia = Number(inp_assistencia.value)
        var mortes = Number(inp_mortes.value)
        var kill = Number( inp_kill.value)
        var calculo = parseFloat((kill+assistencia)/mortes).toFixed(2)
        receber_kda.innerHTML = `seu KDA é ${calculo}`

    }
</script>